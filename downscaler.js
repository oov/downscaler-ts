!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DownScaler=e():t.DownScaler=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}(r(1))},function(t,e,r){"use strict";function n(t,e){var r=t>>>16&65535,n=65535&t,a=e>>>16&65535,f=65535&e;return n*f+(r*f+n*a<<16>>>0)|0}function a(t,e){if(0===t)return e;for(;0!==e;)t>e?t-=e:e-=t;return t}function f(t,e){return y(t,e)/a(t,e)}function i(t,e){for(var r=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),n=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),a=t.width,i=e.width,o=0|f(a,i),d=o/a|0,u=o/i|0,h=new Int32Array(i+1),c=new Int32Array(i+1),w=0;w<=i;++w)c[w]=y(u,w+1)%d,h[w]=y(u,w)/d|0;for(var s=e.height,b=t.width<<2,l=e.width<<2,p=0;p<s;++p)for(var v=y(p,l),g=y(p,b),A=0,O=0;A<i;++A){var U=h[A],m=h[A+1],x=d-O;O=c[A];var L=0,j=0,M=0,_=0,P=0;0!==x&&(P=y(r[g+3],x),j+=y(r[g+0],P),M+=y(r[g+1],P),_+=y(r[g+2],P),L+=P,g+=4);for(var w=U+1;w<m;++w)P=y(r[g+3],d),j+=y(r[g+0],P),M+=y(r[g+1],P),_+=y(r[g+2],P),L+=P,g+=4;0!==O&&(P=y(r[g+3],O),j+=y(r[g+0],P),M+=y(r[g+1],P),_+=y(r[g+2],P),L+=P),0===L?(n[v+0]=0,n[v+1]=0,n[v+2]=0,n[v+3]=0):(n[v+0]=j/L|0,n[v+1]=M/L|0,n[v+2]=_/L|0,n[v+3]=L/u|0),v+=4}}function o(t,e){for(var r=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),n=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),a=t.height,i=e.height,o=f(a,i),d=o/a|0,u=o/i|0,h=new Int32Array(i+1),c=new Int32Array(i+1),w=0;w<=i;++w)c[w]=y(u,w+1)%d,h[w]=y(u,w)/d|0;for(var s=t.width<<2,b=e.width<<2,l=0;l<b;l+=4)for(var p=l,v=l,g=0,A=0;g<i;++g){var O=h[g],U=h[g+1],m=d-A;A=c[g];var x=0,L=0,j=0,M=0,_=0;0!==m&&(_=y(r[v+3],m),L+=y(r[v+0],_),j+=y(r[v+1],_),M+=y(r[v+2],_),x+=_,v+=s);for(var w=O+1;w<U;++w)_=y(r[v+3],d),L+=y(r[v+0],_),j+=y(r[v+1],_),M+=y(r[v+2],_),x+=_,v+=s;0!==A&&(_=y(r[v+3],A),L+=y(r[v+0],_),j+=y(r[v+1],_),M+=y(r[v+2],_),x+=_),0===x?(n[p+0]=0,n[p+1]=0,n[p+2]=0,n[p+3]=0):(n[p+0]=L/x|0,n[p+1]=j/x|0,n[p+2]=M/x|0,n[p+3]=x/u|0),p+=b}}function d(t){for(var e=new Uint8ClampedArray(256),r=0;r<256;++r)e[r]=255*Math.pow(r/255,t);return new Uint8Array(e.buffer,0,256)}function u(t,e){for(var r=d(e),n=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),a=t.data.byteLength,f=0;f<a;f+=4)n[f+0]=r[n[f+0]],n[f+1]=r[n[f+1]],n[f+2]=r[n[f+2]]}function h(t,e,r){if(t.width<e.width||t.height<e.height)throw new Error("upscale is not supported");if(void 0!==r&&u(t,r),t.height!==e.height)if(t.width!==e.width){var n={width:e.width,height:t.height,data:new Uint8ClampedArray(y(e.width<<2,t.height))};i(t,n),o(n,e)}else o(t,e);else if(t.width!==e.width)i(t,e);else for(var a=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength),f=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),d=t.data.byteLength,h=0;h<d;++h)f[h]=a[h];void 0!==r&&u(e,1/r)}Object.defineProperty(e,"__esModule",{value:!0});var y=Math.imul?Math.imul:n;e.scale=h}])});