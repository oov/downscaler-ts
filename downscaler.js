!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.DownScaler=r():t.DownScaler=r()}(this,function(){return function(t){function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var e={};return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},r.p="",r(r.s=0)}([function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(t){for(var e in t)r.hasOwnProperty(e)||(r[e]=t[e])}(e(1))},function(t,r,e){"use strict";function a(t,r){var e=t>>>16&65535,a=65535&t,n=r>>>16&65535,i=65535&r;return a*i+(e*i+a*n<<16>>>0)|0}function n(t,r){if(0===t)return r;for(;0!==r;)t>r?t-=r:r-=t;return t}function i(t,r){return g(t,r)/n(t,r)}function f(t,r){for(var e=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.length),a=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.length),n=t.width,f=r.width,h=0|i(n,f),o=h/n|0,d=h/f|0,u=new Int32Array(f+1),w=new Int32Array(f+1),c=0;c<=f;++c)w[c]=g(d,c+1)%o,u[c]=g(d,c)/o|0;for(var l=r.height,v=t.width<<2,y=r.width<<2,s=0;s<l;++s)for(var p=g(s,y),b=g(s,v),A=0,O=0;A<f;++A){var U=u[A],x=u[A+1],m=o-O;O=w[A];var I=0,j=0,M=0,_=0,P=0;0!==m&&(P=g(e[b+3],m),j+=g(e[b+0],P),M+=g(e[b+1],P),_+=g(e[b+2],P),I+=P,b+=4);for(var c=U+1;c<x;++c)P=g(e[b+3],o),j+=g(e[b+0],P),M+=g(e[b+1],P),_+=g(e[b+2],P),I+=P,b+=4;0!==O&&(P=g(e[b+3],O),j+=g(e[b+0],P),M+=g(e[b+1],P),_+=g(e[b+2],P),I+=P),0===I?(a[p+0]=0,a[p+1]=0,a[p+2]=0,a[p+3]=0):(a[p+0]=j/I|0,a[p+1]=M/I|0,a[p+2]=_/I|0,a[p+3]=I/d|0),p+=4}}function h(t,r){for(var e=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.length),a=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.length),n=t.height,f=r.height,h=i(n,f),o=h/n|0,d=h/f|0,u=new Int32Array(f+1),w=new Int32Array(f+1),c=0;c<=f;++c)w[c]=g(d,c+1)%o,u[c]=g(d,c)/o|0;for(var l=t.width<<2,v=r.width<<2,y=0;y<v;y+=4)for(var s=y,p=y,b=0,A=0;b<f;++b){var O=u[b],U=u[b+1],x=o-A;A=w[b];var m=0,I=0,j=0,M=0,_=0;0!==x&&(_=g(e[p+3],x),I+=g(e[p+0],_),j+=g(e[p+1],_),M+=g(e[p+2],_),m+=_,p+=l);for(var c=O+1;c<U;++c)_=g(e[p+3],o),I+=g(e[p+0],_),j+=g(e[p+1],_),M+=g(e[p+2],_),m+=_,p+=l;0!==A&&(_=g(e[p+3],A),I+=g(e[p+0],_),j+=g(e[p+1],_),M+=g(e[p+2],_),m+=_),0===m?(a[s+0]=0,a[s+1]=0,a[s+2]=0,a[s+3]=0):(a[s+0]=I/m|0,a[s+1]=j/m|0,a[s+2]=M/m|0,a[s+3]=m/d|0),s+=v}}function o(t,r){for(var e=t.data,a=r.data,n=t.width,f=r.width,h=0|i(n,f),o=h/n|0,d=h/f|0,u=new Int32Array(f+1),w=new Int32Array(f+1),c=0;c<=f;++c)w[c]=g(d,c+1)%o,u[c]=g(d,c)/o|0;for(var l=r.height,v=t.width<<2,y=r.width<<2,s=0;s<l;++s)for(var p=g(s,y),b=g(s,v),A=0,O=0;A<f;++A){var U=u[A],x=u[A+1],m=o-O;O=w[A];var I=0,j=0,M=0,_=0,P=0;0!==m&&(P=e[b+3]*m,j+=e[b+0]*P,M+=e[b+1]*P,_+=e[b+2]*P,I+=P,b+=4);for(var c=U+1;c<x;++c)P=e[b+3]*o,j+=e[b+0]*P,M+=e[b+1]*P,_+=e[b+2]*P,I+=P,b+=4;0!==O&&(P=e[b+3]*O,j+=e[b+0]*P,M+=e[b+1]*P,_+=e[b+2]*P,I+=P),0===I?(a[p+0]=0,a[p+1]=0,a[p+2]=0,a[p+3]=0):(a[p+0]=j/I,a[p+1]=M/I,a[p+2]=_/I,a[p+3]=I/d),p+=4}}function d(t,r){for(var e=t.data,a=r.data,n=t.height,f=r.height,h=i(n,f),o=h/n|0,d=h/f|0,u=new Int32Array(f+1),w=new Int32Array(f+1),c=0;c<=f;++c)w[c]=g(d,c+1)%o,u[c]=g(d,c)/o|0;for(var l=t.width<<2,v=r.width<<2,y=0;y<v;y+=4)for(var s=y,p=y,b=0,A=0;b<f;++b){var O=u[b],U=u[b+1],x=o-A;A=w[b];var m=0,I=0,j=0,M=0,_=0;0!==x&&(_=e[p+3]*x,I+=e[p+0]*_,j+=e[p+1]*_,M+=e[p+2]*_,m+=_,p+=l);for(var c=O+1;c<U;++c)_=e[p+3]*o,I+=e[p+0]*_,j+=e[p+1]*_,M+=e[p+2]*_,m+=_,p+=l;0!==A&&(_=e[p+3]*A,I+=e[p+0]*_,j+=e[p+1]*_,M+=e[p+2]*_,m+=_),0===m?(a[s+0]=0,a[s+1]=0,a[s+2]=0,a[s+3]=0):(a[s+0]=I/m,a[s+1]=j/m,a[s+2]=M/m,a[s+3]=m/d),s+=v}}function u(t){for(var r=new Uint16Array(256),e=0;e<256;++e)r[e]=65535*Math.pow(e/255,t)|0;return r}function w(t){for(var r=new Uint8Array(65536),e=0;e<65536;++e)r[e]=255*Math.pow(e/65535,t)|0;return r}function c(t,r){for(var e=u(r),a={width:t.width,height:t.height,data:new Uint16Array(t.data.length)},n=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.length),i=a.data,f=t.data.length,h=0;h<f;h+=4)i[h+0]=e[n[h+0]],i[h+1]=e[n[h+1]],i[h+2]=e[n[h+2]],i[h+3]=g(n[h+3],257);return a}function l(t,r,e){for(var a=w(r),n=t.data,i=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.length),f=t.data.length,h=0;h<f;h+=4)i[h+0]=a[n[h+0]],i[h+1]=a[n[h+1]],i[h+2]=a[n[h+2]],i[h+3]=n[h+3]>>8}function v(t,r,e){if(t.width<r.width||t.height<r.height)throw new Error("upscale is not supported");if(t.width!==r.width||t.height!==r.height){if(void 0!==e)return y(t,r,e);if(t.height!==r.height)if(t.width!==r.width){var a={width:r.width,height:t.height,data:new Uint8ClampedArray(g(r.width<<2,t.height))};f(t,a),h(a,r)}else h(t,r);else f(t,r)}else for(var n=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.length),i=new Uint8Array(r.data.buffer,r.data.byteOffset,r.data.length),o=t.data.length,d=0;d<o;++d)i[d]=n[d]}function y(t,r,e){var a=c(t,e),n={width:r.width,height:r.height,data:new Uint16Array(r.data.length)};if(t.height!==r.height)if(t.width!==r.width){var i={width:r.width,height:t.height,data:new Uint16Array(g(r.width<<2,t.height))};o(a,i),d(i,n)}else d(a,n);else o(a,n);l(n,1/e,r)}Object.defineProperty(r,"__esModule",{value:!0});var g=Math.imul?Math.imul:a;r.scale=v}])});